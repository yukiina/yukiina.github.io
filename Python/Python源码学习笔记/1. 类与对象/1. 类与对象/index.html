<!DOCTYPE html>
<html lang="en">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  <link rel="icon" href="">
  <title>1. 从零开始的Python源码学习-类与对象 | </title>
  <meta name="author" content="Zwm" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="Python, Python源码" />
  
  <meta name="description" content="在Python中一切皆对象, Python的动态性依赖于底层的对象系统的设计, 学习和理解Python对象系统, 是学习Python源码的第一步。">
<meta property="og:type" content="article">
<meta property="og:title" content="1. 从零开始的Python源码学习-类与对象">
<meta property="og:url" content="https://yukiina.github.io/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/index.html">
<meta property="og:site_name">
<meta property="og:description" content="在Python中一切皆对象, Python的动态性依赖于底层的对象系统的设计, 学习和理解Python对象系统, 是学习Python源码的第一步。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://yukiina.github.io/null">
<meta property="article:published_time" content="2021-05-28T05:52:00.000Z">
<meta property="article:modified_time" content="2021-05-30T14:21:40.381Z">
<meta property="article:author" content="Zwm">
<meta property="article:tag" content="Python">
<meta property="article:tag" content="Python源码">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://yukiina.github.io/null">
<meta name="twitter:site" content="@null">
  
  <!-- 站点验证相关 -->
  
    
    
    
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kratosr.min.css" type="text/css" media="all">
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/night-eighties.min.css" type="text/css" media="all">
  
  
  <link rel="stylesheet" id="fontawe-css" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" type="text/css" media="all">
  <link rel="stylesheet" id="nprogress-css" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" type="text/css" media="all">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">
  
  
    <link rel="stylesheet" id="darkmode-css" href="/css/kr-dark.min.css" type="text/css" media="all">
  
  <!-- 不得不预先加载的一些JS文件 -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  
    <script src="https://cdn.jsdelivr.net/npm/qrcode_js@1.0.0/qrcode.min.js"></script>
  
<meta name="generator" content="Hexo 5.4.0"></head>


    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    
                                        <li><a href="/"><i class="fa fa-home"></i>首页</a></li>
                                    
                                
                                    
                                        <li><a href="/archives/"><i class="fa fa-file"></i>档案馆</a></li>
                                    
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/"></a></div>
                    <div class="nav-toggle">
                        <a class="kratos-nav-toggle js-kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2></h2> <br />
                        <span>どんな辛い世界の闇の中でさえ きっとあなたは輝いて</span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">
                    

        <section class="col-md-8">
    <article>
        <div class="kratos-hentry kratos-post-inner clearfix">
            <header class="kratos-entry-header">
                
                    <h1 class="kratos-entry-title text-center">1. 从零开始的Python源码学习-类与对象</h1>
                
                
                <ul class="kratos-post-meta text-center">
                    <li><i class="fa fa-calendar"></i> 2021-05-28</li>
                    <li><i class="fa fa-user"></i> 作者 Zwm</li>
                    <li>
                        <i class="fa fa-edit"></i> 
                        
                        
                            ~7.92K
                        
                        字
                    </li>
                    
                </ul>
            </header>
            <div class="kratos-post-content">
                <div id="expire-alert" class="alert alert-warning hidden" role="alert">
                    本文最后编辑于 <time datetime="1622384500381"></time> 前，其中的内容可能需要更新。
                </div>
                
                    <div class="kratos-post-inner-toc">
                        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-Python%E4%B8%80%E5%88%87%E7%9A%86%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.</span> <span class="toc-text">一. Python一切皆对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-PyObject-%E2%80%94-%E5%AF%B9%E8%B1%A1%E6%9C%BA%E5%88%B6%E6%A0%B8%E5%BF%83"><span class="toc-number">2.</span> <span class="toc-text">二.  PyObject — 对象机制核心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-PyVarObject-%E2%80%94-%E5%8F%AF%E5%8F%98%E9%95%BF%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.</span> <span class="toc-text">三.  PyVarObject — 可变长对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B-PyTypeObject-%E2%80%94-%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83"><span class="toc-number">4.</span> <span class="toc-text">四.  PyTypeObject — 类型系统核心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94-PyType-Type%E4%B8%8EPyBaseObject-Type"><span class="toc-number">5.</span> <span class="toc-text">五.  PyType_Type与PyBaseObject_Type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#END"><span class="toc-number">6.</span> <span class="toc-text">END:</span></a></li></ol>
                    </div>
                
                <hr />
                <p>在Python中一切皆对象, Python的动态性依赖于底层的对象系统的设计, 学习和理解Python对象系统, 是学习Python源码的第一步。</p>
<span id="more"></span>

<h3 id="一-Python一切皆对象"><a href="#一-Python一切皆对象" class="headerlink" title="一. Python一切皆对象"></a>一. Python一切皆对象</h3><p>​    在传统面向对象的语言中, 一般有”类”和”对象”的概念, 通过定义的”类”来实例化”对象”; 然而在Python中一切皆对象, 不管是”类”还是”对象”都是对象。”类”被称为<strong>类型对象</strong>, 实例化的”对象”被称为<strong>实例对象</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python中可以使用 type() 获取一个对象的类型</span></span><br><span class="line">num = <span class="built_in">int</span>(<span class="number">123</span>) <span class="comment"># 123 是一个实例对象, num只是一个指向123的指针</span></span><br><span class="line"><span class="built_in">type</span>(num)      <span class="comment"># &lt;type &#x27;int&#x27;&gt;, num指向的实例对象123的类型为int</span></span><br><span class="line"><span class="built_in">type</span>(<span class="built_in">int</span>)      <span class="comment"># &lt;type &#x27;type&#x27;&gt;, 类型对象int的类型是type</span></span><br><span class="line"><span class="built_in">type</span>(<span class="built_in">type</span>)     <span class="comment"># &lt;type &#x27;type&#x27;&gt;, 类型对象type的类型是type</span></span><br></pre></td></tr></table></figure>

<p>​    从上面的示例中了解到, int, str等类型对象是由<strong>type</strong>实例化得到的类型对象, 因为Python中一切皆对象的设计, type的类型也被设计为了type, type也被称为<strong>元类</strong>。</p>
<div class="alert alert-success"><p>Python中一切皆对象: 实例对象, 类型对象, 元类</p>
</div>

<p>​    在传统面向对象中类型的继承, Python中也有一个很特殊的类型对象, 所有类继承的终点<strong>object</strong>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python中使用 __bases__ 查看一个类型的继承的基类</span></span><br><span class="line"><span class="built_in">int</span>.__bases__      <span class="comment"># (&lt;type &#x27;object&#x27;&gt;,), int基类是object</span></span><br><span class="line"><span class="built_in">type</span>.__bases__     <span class="comment"># (&lt;type &#x27;object&#x27;&gt;,), type基类是object</span></span><br><span class="line"><span class="built_in">object</span>.__bases__   <span class="comment"># (), object是终点</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 一般自定义类型都会显式继承object或其他类型</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params"><span class="built_in">object</span></span>):</span> <span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Man</span>(<span class="params">Person</span>):</span> <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">Person.__bases__  <span class="comment"># (&lt;type &#x27;object&#x27;&gt;,)</span></span><br><span class="line">Man.__bases__     <span class="comment"># (&lt;class &#x27;__main__.Person&#x27;&gt;,)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># __bases__查看当前继承的基类, 也就是写在括号里的; mro 方法查找顺序, 从类本身到object</span></span><br><span class="line">Man.__mro__   <span class="comment"># (&lt;class &#x27;__main__.Man&#x27;&gt;, &lt;class &#x27;__main__.Person&#x27;&gt;, &lt;type &#x27;object&#x27;&gt;) </span></span><br></pre></td></tr></table></figure>

<p>​    从上面的示例中我们学习了另一个特殊的类型对象<strong>object</strong>, 是所有类型的最终的基类, 也包括元类, 所以就有一组特殊的关系, 这两个对象的关系需要后面的知识才能进一步解释:</p>
<ul>
<li>type继承自object</li>
<li>object类型是type</li>
</ul>
<div class="alert alert-info"><p>最后Python中一切皆对象的类型对象系统可以总结为如下的一张图</p>
</div>

<img src="/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1.png" class="" title="类与对象">

<hr>
<h3 id="二-PyObject-—-对象机制核心"><a href="#二-PyObject-—-对象机制核心" class="headerlink" title="二.  PyObject — 对象机制核心"></a>二.  PyObject — 对象机制核心</h3><p>​    Python中的任何对象都对应C的一个结构体实例, Python中创建一个对象的本质上相当于C中malloc函数为对应的结构体在堆区申请一块内存。Python将所有对象共有部分抽象成了一个结构体<strong>PyObject</strong>, 是整个对象系统的基石。</p>
<div class="alert alert-info"><p>PyObject结构体的定义在Python2/3中基本相同, 文章还是以Python2为主。</p>
</div>

<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Python2.7.18 Include/object.h 106</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">object</span> &#123;</span></span><br><span class="line">    PyObject_HEAD</span><br><span class="line">&#125; PyObject;</span><br></pre></td></tr></table></figure>

<p>​    <strong>PyObject_HEAD</strong>从名字上看大概能猜到这是一个公共的头部信息, Python中每一个对象的拥有这个头部信息, PyObject_HEAD是一个宏, 展开后定义了一个<strong>_PyObject_HEAD_EXTRA</strong>的宏, 将其全部展开:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Python2.7.18 Include/object.h 106, 78, 66</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">object</span> &#123;</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> _<span class="title">object</span> *_<span class="title">ob_next</span>;</span>     <span class="comment">// 双向链表指针</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> _<span class="title">object</span> *_<span class="title">ob_prev</span>;</span>     <span class="comment">// 双向链表指针</span></span><br><span class="line">   Py_ssize_t ob_refcnt;         <span class="comment">// 引用计数 </span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> _<span class="title">typeobject</span> *<span class="title">ob_type</span>;</span>  <span class="comment">// 类型信息</span></span><br><span class="line">&#125; PyObject;</span><br></pre></td></tr></table></figure>

<div class="panel panel-info">
    <div class="panel-title">PyObject</div>
    <div class="panel-body">
        <ul>
<li><p><strong>_ob_next &amp; _ob_prev:</strong> 维护了一个名叫<strong>refchain</strong>的双向链表, Python会将程序中创建的所有对象放入这个链表中, 用于跟踪所有的<strong>活跃的堆对象</strong>, 这个宏仅在Debug下有用。不是当前关注的重点。</p>
</li>
<li><p><strong>ob_refcnt:</strong> ob_refcnt表示当前对象的引用计数, 当对象被引用时, ob_refcnt自增1, 引用解除时, ob_refcnt自减1。引用计数为0时, 对象会被回收。</p>
<p>使用 del 删除一个对象时, 使对象的引用计数 -1, 引用计数为 0 时, 解释器会删除对象。</p>
<p>ob_refcnt的类型为Py_ssize_t, 64位机器上等同于 long。</p>
</li>
<li><p><strong>ob_type:</strong> ob_type表示当前对象的类型信息的指针。类型信息是一个 struct _typeobject 结构体。</p>
</li>
</ul>

    </div>
    </div>

<p>​    Python中的任意对象都拥有: <strong>引用计数</strong>和<strong>类型信息</strong>这两个属性。</p>
<p>​    因此在Python中, 对象的引用就变得非常统一, PyObject* 就可以引用任何一个类型, 不需要知道这个对象的实际类型, 这也是Python动态语言的基础。在Python 中所有的对象, 以及容器内的元素本质上都是PyObject* 。</p>
<p>​    int是PyObject*, int实例化生成的对象是PyObject* , type是PyObject*, object也是PyObject* 。这也就解释了Python中为什么一切皆对象。</p>
<hr>
<h3 id="三-PyVarObject-—-可变长对象"><a href="#三-PyVarObject-—-可变长对象" class="headerlink" title="三.  PyVarObject — 可变长对象"></a>三.  PyVarObject — 可变长对象</h3><p>​    PyObject结构体有一个很常用的扩展类型, PyVarObject可变长对象, 结构体内部多存储一个元素的数量, Python中列表等可变长对象都直接使用了这个结构体。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Python2.7.18 Include/object.h 110</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> &#123;</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> _<span class="title">object</span> *_<span class="title">ob_next</span>;</span>     <span class="comment">// 双向链表指针</span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> _<span class="title">object</span> *_<span class="title">ob_prev</span>;</span>     <span class="comment">// 双向链表指针</span></span><br><span class="line">   Py_ssize_t ob_refcnt;         <span class="comment">// 引用计数 </span></span><br><span class="line">   <span class="class"><span class="keyword">struct</span> _<span class="title">typeobject</span> *<span class="title">ob_type</span>;</span>  <span class="comment">// 类型信息</span></span><br><span class="line">   Py_ssize_t ob_size;           <span class="comment">// 新增了一个表示对象内元素个数的成员</span></span><br><span class="line">&#125; PyVarObject;</span><br></pre></td></tr></table></figure>

<p>​    因为PyObject和PyVarObject使用广泛, Python定义了两个宏<strong>PyObject_HEAD</strong>和<strong>PyObject_VAR_HEAD</strong>, 表示这两种对象的成员, 常见于各种对象的结构体定义中。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Python2.7.18 Include/object.h 78, 96</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PyObject_HEAD                   \</span></span><br><span class="line"><span class="meta">    _PyObject_HEAD_EXTRA                \</span></span><br><span class="line"><span class="meta">    Py_ssize_t ob_refcnt;               \</span></span><br><span class="line"><span class="meta">    struct _typeobject *ob_type;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> PyObject_VAR_HEAD               \</span></span><br><span class="line"><span class="meta">    PyObject_HEAD                       \</span></span><br><span class="line"><span class="meta">    Py_ssize_t ob_size;</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="四-PyTypeObject-—-类型系统核心"><a href="#四-PyTypeObject-—-类型系统核心" class="headerlink" title="四.  PyTypeObject — 类型系统核心"></a>四.  PyTypeObject — 类型系统核心</h3><p>​    在PyObject的结构体中有一个类型信息的成员, <strong>struct _typeobject*</strong>, 又被命名为PyTypeObject。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Python2.7.18 Include/object.h 324</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">typeobject</span> &#123;</span></span><br><span class="line">    PyObject_VAR_HEAD    <span class="comment">// 可变长对象 </span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *tp_name; <span class="comment">// 类型的名称, 如: int, str, type, object</span></span><br><span class="line">    Py_ssize_t tp_basicsize, tp_itemsize; <span class="comment">// 创建对应实例对象时所需要的内存信息</span></span><br><span class="line"></span><br><span class="line">    destructor tp_dealloc;  <span class="comment">// 实例对象执行析构函数时所作的操作</span></span><br><span class="line">    printfunc tp_print;     <span class="comment">// 实例对象被打印时所作的操作</span></span><br><span class="line">    getattrfunc tp_getattr; <span class="comment">// getattr </span></span><br><span class="line">    setattrfunc tp_setattr; <span class="comment">// setattr</span></span><br><span class="line">    cmpfunc tp_compare;     <span class="comment">// 比较</span></span><br><span class="line">    reprfunc tp_repr;       <span class="comment">// repr</span></span><br><span class="line"></span><br><span class="line">    PyNumberMethods *tp_as_number;     <span class="comment">// 实例对象为数值时，所支持的操作</span></span><br><span class="line">    PySequenceMethods *tp_as_sequence; <span class="comment">// 实例对象为序列时，所支持的操作</span></span><br><span class="line">    PyMappingMethods *tp_as_mapping;   <span class="comment">// 实例对象为映射时，所支持的操作</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// .......</span></span><br><span class="line">&#125; PyTypeObject;</span><br></pre></td></tr></table></figure>

<p>​    PyTypeObject定义了对象的元信息, 名字, 支持的操作等, Python所有的类型对象都是由PyTypeObject定义的对象, 在C层面对应了一个全局变量。例如Python中的<strong>float</strong>类型对应了<strong>PyFloat_Type</strong>:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Python2.7.18 Objects/floatobject.c 2120</span></span><br><span class="line">PyTypeObject PyFloat_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)</span><br><span class="line">    <span class="string">&quot;float&quot;</span>,</span><br><span class="line">    <span class="keyword">sizeof</span>(PyFloatObject)</span><br><span class="line">    <span class="comment">// ......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<div class="panel panel-info">
    <div class="panel-title">PyFloat_Type</div>
    <div class="panel-body">
        <ul>
<li><p>PyVarObject_HEAD_INIT 是一个宏, 用于初始化, PyObject_VAR_HEAD, 借助IDE看一下宏展开:</p>
<img src="/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/%E5%AE%8F%E5%B1%95%E5%BC%80.png" class="" title="宏展开">

<p>PyFloat_Type的 ob_type被设置为了PyType_Type, PyType_Type对应Python的type, 这也能解释Python中float的类型是type。</p>
</li>
<li><p>tp_name 名字被设置为float, 对应Python中的名字。</p>
</li>
<li><p>sizeof(PyFloatObject)  保存定义一个float对象的内存大小。</p>
</li>
</ul>

    </div>
    </div>

<p>​    其实类型对象的命名非常有规律, 基本都是PyXXX_Type, 如: PyFloat_Type, PyType_Type。</p>
<p>​    同理实例对象的命名, 基本都是PyXXXObject, 如: PyFloatObject, PyLongObject。</p>
<p>​    但是所有的类型对象都是PyTypeObject类型, 实例对象则使用对应的类型创建, 如下表:</p>
<table>
<thead>
<tr>
<th align="center">类型</th>
<th align="center">实例对象</th>
<th align="center">类型对象</th>
</tr>
</thead>
<tbody><tr>
<td align="center">整型</td>
<td align="center">PyLongObject类型</td>
<td align="center">PyLong_Type(PyTypeObject类型)</td>
</tr>
<tr>
<td align="center">字符串</td>
<td align="center">PyUnicodeObject类型</td>
<td align="center">PyUnicode_Type(PyTypeObject类型)</td>
</tr>
<tr>
<td align="center">浮点数</td>
<td align="center">PyFloatObject类型</td>
<td align="center">PyFloat_Type(PyTypeObject类型)</td>
</tr>
<tr>
<td align="center">复数</td>
<td align="center">PyComplexObject类型</td>
<td align="center">PyComplex_Type(PyTypeObject类型)</td>
</tr>
<tr>
<td align="center">元组</td>
<td align="center">PyTupleObject类型</td>
<td align="center">PyTuple_Type(PyTypeObject类型)</td>
</tr>
<tr>
<td align="center">列表</td>
<td align="center">PyListObject类型</td>
<td align="center">PyList_Type(PyTypeObject类型)</td>
</tr>
<tr>
<td align="center">字典</td>
<td align="center">PyDictObject类型</td>
<td align="center">PyDict_Type(PyTypeObject类型)</td>
</tr>
<tr>
<td align="center">集合</td>
<td align="center">PySetObject类型</td>
<td align="center">PySet_Type(PyTypeObject类型)</td>
</tr>
<tr>
<td align="center">元类</td>
<td align="center"></td>
<td align="center">PyType_Type(PyTypeObject类型)</td>
</tr>
</tbody></table>
<p>​    PyXXXObject和PyXXX_Type的对应关系如下图所示:</p>
<img src="/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/%E5%AF%B9%E8%B1%A1%E5%AE%9E%E4%BE%8B%E7%B1%BB%E5%9E%8B.jpg" class="" title="对象实例类型">

<div class="panel panel-info">
    <div class="panel-title">Python动态性和弊端</div>
    <div class="panel-body">
        <p>​    Python底层通过PyObject和PyTypeObject完成了C++所提供的对象的多态特性。</p>
<p>​    在Python中创建一个对象，会分配内存并进行初始化，然后Python会用一个PyObject *来保存和维护这个对象, 所以变量在保存一个对象的指针时，会将该指针转成PyObject *之后再交给变量保存。</p>
<p>​    因此在Python中，变量的传递实际上传递的都是一个泛型指针：PyObject *。这个指针具体是指向的什么类型我们并不知道，只能通过其内部的ob_type成员进行动态判断，而正是因为这个ob_type，Python实现了动态性。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 对于C来讲，由于已经规定好了类型，所以a + b在编译之后就是一条简单的机器指令</span></span><br><span class="line">C++:</span><br><span class="line">    <span class="built_in">int</span> a = <span class="number">1</span>; <span class="built_in">int</span> b = <span class="number">1</span>;</span><br><span class="line">    a + b</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对于Python a,b的类型是不确定的, 首先要通过ob_type判断a,b的类型</span></span><br><span class="line"><span class="comment"># 这在C层面有一次查找, &quot;+&quot; 又会查找一次, 最后将a + b的结果返回一个新的PyObject*</span></span><br><span class="line">Python:</span><br><span class="line">    a = <span class="number">1</span></span><br><span class="line">    b = <span class="number">1</span></span><br><span class="line">    a + b</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​    <strong>所以Python速度慢的很大一部分原因是有相当一部分时间浪费在类型和属性的查找上面的。</strong></p>

    </div>
    </div>

<hr>
<h3 id="五-PyType-Type与PyBaseObject-Type"><a href="#五-PyType-Type与PyBaseObject-Type" class="headerlink" title="五.  PyType_Type与PyBaseObject_Type"></a>五.  PyType_Type与PyBaseObject_Type</h3><div class="alert alert-danger"><p>Tips: object类型对应的是PyBaseObject_Type, 而不是PyObject_Type!!!</p>
</div>

<p>​    回顾之前的内容, type是所有类型的类型, object所有类型的基类, 通过学习这两个类型对象的底层数据结构PyType_Type和PyBaseObject_Type来理解它们之间的关系。</p>
<div class="panel panel-info">
    <div class="panel-title">PyType_Type</div>
    <div class="panel-body">
        <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Python2.7.18 Object/typeobject.c  2879</span></span><br><span class="line">PyTypeObject PyType_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)     	<span class="comment">// 初始化PyVarHead</span></span><br><span class="line">    <span class="string">&quot;type&quot;</span>,                                     <span class="comment">// Python中名字是type</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">// tp_base</span></span><br><span class="line">    <span class="comment">// .......</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>初始化设置ob_type为PyType_Type, 这也就解释了为什么type的类型是type。</p>
</li>
<li><p>Python中的名字设置为type。</p>
</li>
<li><p>这里tp_base基类设置为0, 这里理论上应该是object才对, 不过因为这是一个全局变量, 运行前是不知道PyBaseObject_Type的地址的, 当然就只能先设置为0。运行之后看一下这个变量, 发现tp_base确实被设置了PyBaseObject_Type, 这与我们在Python层面上的理解一致。</p>
<img src="/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/PyType_Type.png" class="" title="PyType_Type"></li>
</ul>

    </div>
    </div>

<p>​    然后再来看一下object类型对象底层PyBaseObject_Type的结构:</p>
<div class="panel panel-info">
    <div class="panel-title">PyBaseObject_Type</div>
    <div class="panel-body">
        <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Object/typeobject.c  3681</span></span><br><span class="line">PyTypeObject PyBaseObject_Type = &#123;</span><br><span class="line">    PyVarObject_HEAD_INIT(&amp;PyType_Type, <span class="number">0</span>)      <span class="comment">// object 的类型被设置为了type</span></span><br><span class="line">    <span class="string">&quot;object&quot;</span>,                                   <span class="comment">// Python中的名字是object</span></span><br><span class="line">    <span class="number">0</span>,                                          <span class="comment">// tp_base</span></span><br><span class="line">    <span class="comment">// .......</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>初始化设置ob_type为PyType_Type, 所以object的类型也是type。</p>
</li>
<li><p>Python中的名字是object。</p>
</li>
<li><p>object是最终的基类, 所以tp_base为0, 运行看一下是否还是0。</p>
<img src="/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/PyBaseObject_Type.png" class="" title="PyBaseObject_Type"></li>
</ul>

    </div>
    </div>

<p>​    现在应该可以完全理解为什么type继承于object, 而object的类型是type, 这个在Python层面上看似像一个闭环的问题。</p>
<p>​    Python通过设计抽象的PyObject使得对象和类型的边界模糊, 在底层任何对象都可以强制转换为PyObject* 。</p>
<hr>
<h3 id="END"><a href="#END" class="headerlink" title="END:"></a>END:</h3><div class="panel panel-success">
    <div class="panel-title">参考链接</div>
    <div class="panel-body">
        <ul>
<li><p><strong>《深度剖析CPython解释器》系列博客:</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/traditional/p/13391098.html">https://www.cnblogs.com/traditional/p/13391098.html</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/traditional/p/13398797.html">https://www.cnblogs.com/traditional/p/13398797.html</a></p>
</li>
</ul>

    </div>
    </div>
            </div>
            
                <div class="kratos-copyright text-center clearfix">
                    <h5>本作品采用 <a rel="license nofollow" target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/">知识共享署名-相同方式共享 4.0 国际许可协议</a> 进行许可</h5>
                </div>
            
            <footer class="kratos-entry-footer clearfix">
                
                    <div class="post-like-donate text-center clearfix" id="post-like-donate">
                    
                    
                        <a class="share" href="javascript:;"><i class="fa fa-share-alt"></i> 分享</a>
                        <div class="share-wrap" style="display: none;">
    <div class="share-group">
        <a href="javascript:;" class="share-plain qq" onclick="share('qq');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-qq"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain qzone" onclick="share('qzone');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-star"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weixin pop style-plain" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weixin"></i>
            </div>
            <div class="share-int">
                <div class="qrcode" id="wechat-qr"></div>
                <p>打开微信“扫一扫”，打开网页后点击屏幕右上角分享按钮</p>
            </div>
        </a>
        <a href="javascript:;" class="share-plain weibo" onclick="share('weibo');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-weibo"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain facebook style-plain" onclick="share('facebook');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-facebook"></i>
            </div>
        </a>
        <a href="javascript:;" class="share-plain twitter style-plain" onclick="share('twitter');" rel="nofollow">
            <div class="icon-wrap">
                <i class="fa fa-twitter"></i>
            </div>
        </a>
    </div>
    <script type="text/javascript">
        $(()=>{
            new QRCode("wechat-qr", {
                text: "https://yukiina.github.io/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/",
                width: 150,
                height: 150,
                correctLevel : QRCode.CorrectLevel.H
            });
        });
        function share(dest) {
            const qqBase        = "https://connect.qq.com/widget/shareqq/index.html?";
            const weiboBase     = "https://service.weibo.com/share/share.php?";
            const qzoneBase     = "https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?";
            const facebookBase  = "https://www.facebook.com/sharer/sharer.php?";
            const twitterBase   = "https://twitter.com/intent/tweet?";
            const hostUrl       = "https://yukiina.github.io/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/";
            const title         = "「1. 从零开始的Python源码学习-类与对象」";
            const excerpt       = `在Python中一切皆对象, Python的动态性依赖于底层的对象系统的设计, 学习和理解Python对象系统, 是学习Python源码的第一步。`;
            let _URL;
            switch (dest) {
                case "qq"       : _URL = qqBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";     break;
                case "weibo"    : _URL = weiboBase+"url="+hostUrl+"&title="+title+excerpt;                                 break;
                case "qzone"    : _URL = qzoneBase+"url="+hostUrl+"&title="+title+"&desc=&summary="+excerpt+"&site=cxpy";  break;
                case "facebook" : _URL = facebookBase+"u="+hostUrl;                                                        break;
                case "twitter"  : _URL = twitterBase+"text="+title+excerpt+"&url="+hostUrl;                                break;
            }
            window.open(_URL);
        };
    </script>
</div>
                    
                    </div>
                
                <div class="footer-tag clearfix">
                    <div class="pull-left">
                    <i class="fa fa-tags"></i>
                        <a class="tag-none-link" href="/tags/Python/" rel="tag">Python</a>, <a class="tag-none-link" href="/tags/Python%E6%BA%90%E7%A0%81/" rel="tag">Python源码</a>
                    </div>
                    <div class="pull-date">
                    <span>最后编辑：2021-05-30</span>
                    </div>
                </div>
            </footer>
        </div>
        
            <nav class="navigation post-navigation clearfix" role="navigation">
                
                <div class="nav-previous clearfix">
                    <a title=" 0. 从零开始的Python源码学习-准备工作" href="/Python/Python源码学习笔记/0. 准备工作/0. 准备工作/">&lt; 上一篇</a>
                </div>
                
                
                <div class="nav-next clearfix">
                    <a title=" 2. 从零开始的Python源码学习-对象的行为" href="/Python/Python源码学习笔记/2. 对象的行为/2. 对象的行为/">下一篇 &gt;</a>
                </div>
                
            </nav>
        
        
    </article>
</section>

                
            

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/images/avatar.webp" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center"></p>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                    <aside id="krw-toc" class="widget widget-kratos-toc clearfix">
    <div class="photo-background"></div>
    <h4 class="widget-title no-after">
        <i class="fa fa-compass"></i>
        文章目录
        <span class="toc-progress-bar"></span>
    </h4>
    <div class="textwidget">
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-Python%E4%B8%80%E5%88%87%E7%9A%86%E5%AF%B9%E8%B1%A1"><span class="toc-text">一. Python一切皆对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-PyObject-%E2%80%94-%E5%AF%B9%E8%B1%A1%E6%9C%BA%E5%88%B6%E6%A0%B8%E5%BF%83"><span class="toc-text">二.  PyObject — 对象机制核心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89-PyVarObject-%E2%80%94-%E5%8F%AF%E5%8F%98%E9%95%BF%E5%AF%B9%E8%B1%A1"><span class="toc-text">三.  PyVarObject — 可变长对象</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9B-PyTypeObject-%E2%80%94-%E7%B1%BB%E5%9E%8B%E7%B3%BB%E7%BB%9F%E6%A0%B8%E5%BF%83"><span class="toc-text">四.  PyTypeObject — 类型系统核心</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%94-PyType-Type%E4%B8%8EPyBaseObject-Type"><span class="toc-text">五.  PyType_Type与PyBaseObject_Type</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#END"><span class="toc-text">END:</span></a></li></ol>
    </div>
</aside>
                
                
  <aside id="krw-categories" class="widget widget-kratos-categories clearfix">
    <h4 class="widget-title"><i class="fa fa-folder"></i>分类目录</h4>
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Demo/">Demo</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a><span class="category-list-count">3</span></li></ul>
  </aside>


            
                
  <aside id="krw-tags" class="widget widget-kratos-tags clearfix">
    <h4 class="widget-title"><i class="fa fa-tags"></i>标签聚合</h4>
      <div class="tag-clouds">
        <a href="/tags/Python/" style="font-size: 0.6em;">Python</a> <a href="/tags/Python%E6%BA%90%E7%A0%81/" style="font-size: 0.6em;">Python源码</a> <a href="/tags/Tag0/" style="font-size: 0.6em;">Tag0</a> <a href="/tags/Tag1/" style="font-size: 0.6em;">Tag1</a> <a href="/tags/Tag2/" style="font-size: 0.6em;">Tag2</a>
      </div>
  </aside>

            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/Demo/hello-world/"><i class="fa  fa-book"></i> Hello World</a>
            
          
        
          
          
            <a class="list-group-item" href="/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/2.%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%A1%8C%E4%B8%BA/2.%20%E5%AF%B9%E8%B1%A1%E7%9A%84%E8%A1%8C%E4%B8%BA/"><i class="fa  fa-book"></i> 2. 从零开始的Python源码学习-对象的行为</a>
            
          
        
          
          
            <a class="list-group-item" href="/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/1.%20%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/"><i class="fa  fa-book"></i> 1. 从零开始的Python源码学习-类与对象</a>
            
          
        
          
          
            <a class="list-group-item" href="/Python/Python%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/0.%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/0.%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/"><i class="fa  fa-book"></i> 0. 从零开始的Python源码学习-准备工作</a>
            
          
        
          
          
            <a class="list-group-item" href="/Demo/%E6%9D%82%E9%A1%B9/0.%20%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C/"><i class="fa  fa-book"></i> hello</a>
            
          
        
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
        
        </div>
    </div>
</div>
<footer>
    <div id="footer"  class="ap-lrc"  >
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search/">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                
                    <div class="box theme-box" id="darkmode-switch">
                        <span class="fa fa-adjust"></span>
                    </div>
                
                
            </div>
            <div class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        
                        <li><a href="mailto:15319783808@163.com"><i class="fa fa-envelope"></i></a></li>
                        
                        
                        
                        
                        
                        <li><a target="_blank" rel="nofollow" href="https://github.com/yukiina"><i class="fa fa-github"></i></a></li>
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2021 Zwm 版权所有.</li>
                            <li><span id="span_dt">Loading...</span></li>
                        </div>
                        <div>
                            <li>Theme <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a></li>
                            <li>Site built with&nbsp;<i class="fa fa-heart throb" style="color:#d43f57"></i>&nbsp;by Zwm.</li>
                        </div>
                        <div>
                            <li>Powered by <a href="https://hexo.io" target="_blank" rel="nofollow">Hexo</a></li>
                            <li>Hosted on <a href="https://github.io" target="_blank">Github Pages</a></li>
                        </div>
                        <div>
                            
                            
                        </div>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</footer>
</div>
</div>

        <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.4/dist/js/bootstrap.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.js"></script>
<script>const notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));</script>

<script async src="/js/candy.min.js"></script>

    <script defer src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>
    <meting-js
        server="netease"
        type="playlist"
        id="328351494"
        order="random"
        fixed="true"
    >
    </meting-js>



    <script defer src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

<script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script>
<script defer src="/js/kratosr.min.js"></script>
<script defer src="/js/pjax.min.js"></script>


    <script defer src="/js/kr-dark.min.js"></script>



<!-- Extra support for third-party plguins  -->


    </body>
</html>